#include<iostream>
#include<string>
using namespace std;
#include<stdlib.h>
#include<time.h>
struct player{float holdvote;bool identifier;bool eye;float vote;bool exile=1;bool add=0;          //exile表示放逐情况，1表示未被放逐，0表示被放逐 ,add表示红黑夜后村长加票情况 
}redandblack[20];
string speak;                //speak记录每名玩家的发言  
int a[20];                     //a[20]储存得到最高票数的编号 
int chief=0;                        //chief储存村长的编号 
float nummax;                    //nummax表示最多票数是多少 
int namemax;                        //namemax表示票数最多的人的编号 
int nowred;                          //表示场上红牌的数量 
int nowblack;                        //表示场上黑牌的数量 
void getidentifier(int number)//发身份牌 
{
	cout<<"给每位玩家随机发身份牌(1代表红牌，0代表黑牌)"<<endl;
	int b[100],c[20],j;
	for(int i=1;i<=number;i++)
	{
		b[i]=1;
	}
	srand((unsigned)time(NULL));
	for(int i=1;i<=number;i++)          //数组c储存1到n的随机数 
	{
		j=rand();
		j=j%(number-1+1)+1;
		if(b[j]==0){i=i-1;continue;}
		else {
				c[i]=j;b[j]=0;
			 }
	}
	for(int i=1;i<=number;i++)
	{
		if(c[i]%2==1)redandblack[i].identifier=1;
		else redandblack[i].identifier==0;
	}
	for(int i=1;i<=number;i++)
	{
		if(redandblack[i].identifier==1)cout<<i<<"号玩家的身份是"<<redandblack[i].identifier<<"（红牌）"<<endl;
		else cout<<i<<"号玩家的身份是"<<redandblack[i].identifier<<"（黑牌）" <<endl;
	}
}
void selectnamemax1(int number)//选出得票数最多的人的编号 
{
	int n=0;
	for(int i=1;i<=number;i++)
	{
		if(redandblack[i].exile==0)continue;
		cout<<i<<"号玩家发言：";
		cin>>speak;
	}
	cout<<"发言结束,请投票 "<<endl;

		for(int j=1;j<=number;j++)        //把每个人得到的票数置0 
		{
		redandblack[j].vote=0;
		}
	for(int i=1;i<=number;i++)            //开始投票 
	{

		int name;
		if(redandblack[i].exile==0)continue;
		cout<<i<<"号玩家投票：";
		cin>>name;redandblack[name].vote=redandblack[name].vote+redandblack[i].holdvote;
	}
	for(int i=1;i<=number;i++)          //输出每个玩家的得票数 
	{
		if(redandblack[i].exile==0)continue;
		cout<<i<<"号玩家的得票数为"<<redandblack[i].vote<<endl;
	}
	nummax=redandblack[number].vote;
	 for(int i=1;i<=number;i++)           //得出最多的票数
	{
		if(nummax>redandblack[i].vote);
		else nummax=redandblack[i].vote;
		if(i==number)
		{
			for(int j=1;j<=number;j++)
			{
				if(nummax==redandblack[j].vote){n++;namemax=j;a[n]=j;}
			}//得出拥有最高票数的有几人 
			if(n==1){return;}
		}	
	}
			while(n!=1)//当n大于1时再次进行发言直到选出得到最多票数的人 
			{
				int copyn=n;
				n=0;
				cout<<"有多个最高票数者，请重新发言投票" <<endl;
				for(int j=1;j<=copyn;j++)
				{
					cout<<a[j]<<"号玩家再次发言:";
					cin>>speak;
				}
				cout<<"发言结束,请投票 "<<endl;
				for(int j=1;j<=number;j++)                          //把每个人得到的票数置0 
				{
					redandblack[j].vote=0;
				}
				for(int j=1;j<=number;j++)
				{
					int name;
					if(redandblack[j].exile==0)continue;
					cout<<j<<"号玩家投票：";
					cin>>name;redandblack[name].vote=redandblack[name].vote+redandblack[j].holdvote;
				}
				for(int i=1;i<=copyn;i++)
				{
					cout<<a[i]<<"号玩家的得票数为"<<redandblack[a[i]].vote<<endl;
				}				
				nummax=redandblack[number].vote;
				for(int t=1;t<=copyn;t++)           //得出最多的票数
	 			{
				if(nummax>redandblack[a[t]].vote);
				else nummax=redandblack[a[t]].vote;
					if(t==copyn)
					{
						for(int j=1;j<=copyn;j++)
						{
						if(nummax==redandblack[a[j]].vote){n++;namemax=a[j];a[n]=a[j];}
						}//得出拥有最高票数的有几人 
						if(n==1){return;}
					}
				}
			}//到此选出得票数最多的人的编号 
}
void selectnamemax2(int number)//选出得票数最多的人的编号 
{
	int n=0;
		for(int j=1;j<=number;j++)        //把每个人得到的票数置0 
		{
		redandblack[j].vote=0;
		}
	for(int i=1;i<=number;i++)            //开始投票 
	{

		int name;
		if(redandblack[i].exile==0)continue;
		cout<<i<<"号玩家投票：";
		cin>>name;redandblack[name].vote=redandblack[name].vote+redandblack[i].holdvote;
	}
	for(int i=1;i<=number;i++)          //输出每个玩家的得票数 
	{
		if(redandblack[i].exile==0)continue;
		cout<<i<<"号玩家的得票数为"<<redandblack[i].vote<<endl;
	}
	nummax=redandblack[number].vote;
	 for(int i=1;i<=number;i++)           //得出最多的票数
	{
		if(nummax>redandblack[i].vote);
		else nummax=redandblack[i].vote;
		if(i==number)
		{
			for(int j=1;j<=number;j++)
			{
				if(nummax==redandblack[j].vote){n++;namemax=j;a[n]=j;}
			}//得出拥有最高票数的有几人 
			if(n==1){return;}
		}	
	}
			while(n!=1)//当n大于1时再次进行发言直到选出得到最多票数的人 
			{
				int copyn=n;
				n=0;
				cout<<"有多个最高票数者，请重新发言投票" <<endl;
				for(int j=1;j<=copyn;j++)
				{
					cout<<a[j]<<"号玩家再次发言:";
					cin>>speak;
				}
				cout<<"发言结束,请投票 "<<endl;
				for(int j=1;j<=number;j++)                          //把每个人得到的票数置0 
				{
					redandblack[j].vote=0;
				}
				for(int j=1;j<=number;j++)
				{
					int name;
					if(redandblack[j].exile==0)continue;
					cout<<j<<"号玩家投票：";
					cin>>name;redandblack[name].vote=redandblack[name].vote+redandblack[j].holdvote;
				}
				for(int i=1;i<=copyn;i++)
				{
					cout<<a[i]<<"号玩家的得票数为"<<redandblack[a[i]].vote<<endl;
				}				
				nummax=redandblack[number].vote;
				for(int t=1;t<=copyn;t++)           //得出最多的票数
	 			{
				if(nummax>redandblack[a[t]].vote);
				else nummax=redandblack[a[t]].vote;
					if(t==copyn)
					{
						for(int j=1;j<=copyn;j++)
						{
						if(nummax==redandblack[a[j]].vote){n++;namemax=a[j];a[n]=a[j];}
						}//得出拥有最高票数的有几人 
						if(n==1){return;}
					}
				}
			}//到此选出得票数最多的人的编号 
}
int main()
{
	int number,blacknumber,n=0,rednumber;               //n表示拥有最高票数的人数 
	float max;
	cout<<"请输入玩家的人数:"; 
	cin>>number;
	blacknumber=number/2;rednumber=number-blacknumber;//算出红黑玩家各有多少人 
	nowred=rednumber;nowblack=blacknumber;
	for(int i=1;i<=number;i++)                     //把每个人持有的票数置1
	{
		redandblack[i].holdvote=1;
	}

	getidentifier(number);     //决定每个人的身份 ,1=红牌，0=黑牌 
	cout<<"第一天："<<endl<<"请玩家发言竞选村长"<<endl;
	selectnamemax1(number);
	chief=namemax;
	cout<<"村长是"<<chief<<"号"<<endl;
	if(number%2==1)redandblack[chief].holdvote=0.5;else redandblack[chief].holdvote=1.5;
	cout<<"此时村长所持票数："<<redandblack[chief].holdvote<<endl;
	while(nowred!=0&&nowblack!=0)
	{	
		int j;
		j=rand();                            //随机进入红黑夜 
		if(j%2==1)cout<<"今晚随机进入的是红夜"<<endl;
		else cout<<"今晚随机进入的是黑夜"<<endl;
		cout<<"所有玩家可以选择闭眼或睁眼（0代表睁眼，1代表闭眼）"<<endl;
		for(int i=1,tempred=0,tempblack=0;i<=number;i++)                  //玩家选择睁眼或闭眼并判断村长所持票数 
		{
			          //tempred表示睁眼的红牌数，tempblack表示睁眼的黑牌数 
			if(redandblack[i].exile==0)continue;
			cout<<i<<"号玩家选择：";
			cin>>redandblack[i].eye;
			if(redandblack[i].identifier==1&&redandblack[i].eye==0)tempred=tempred+1;
			if(redandblack[i].identifier==0&&redandblack[i].eye==0)tempblack=tempblack+1;
			if(i==number)
			{
				if(j%2==1&&tempred%2==0){redandblack[chief].holdvote=redandblack[chief].holdvote+1;redandblack[chief].add=1;}cout<<"此时睁眼红牌数："<<tempred<<endl;
				if(j%2==0&&tempblack%2==0){redandblack[chief].holdvote=redandblack[chief].holdvote+1;redandblack[chief].add=1;}cout<<"此时睁眼黑牌数："<<tempblack<<endl; 
				cout<<"本次红黑夜后村长所持票数："<<redandblack[chief].holdvote<<endl;
			}
		}
		cout<<"天亮了"<<endl;
		cout<<"村长决定从自己左边或右边发言（1代表从自己左边，0代表从自己右边）" ;
		int direction;
		cin>> direction;
		if(direction==1)
		{
			if(chief==1)
			{
				if(redandblack[number].exile!=0)cout<<number<<"号玩家发言:";
				cin>>speak;
				for(int i=1;i<number;i++)
				{
					if(redandblack[i].exile==0)continue;
					cout<<i<<"号玩家发言:";
					cin>>speak; 
				}
			}
			if(chief!=1)
			{
				for(int i=1;i<=number;i++)
				{
					
					if(chief-1+i-1>number){if(redandblack[chief+i-number-2].exile==0)continue;
										 else cout<<chief+i-number-2<<"号玩家发言:";}//当number号玩家发言后，从一号玩家开始发言。 
					else {if(redandblack[chief-1+i-1].exile==0)continue;
						  else cout<<chief-1+i-1<<"号玩家发言:";}
					cin>>speak;
				}
			}
		}
		if(direction==0)
		{
			if(chief==number)
			{
				if(redandblack[1].exile!=0)cout<<1<<"号玩家发言:";
				cin>>speak;
				for(int i=number;i>1;i--)
				{
					if(redandblack[i].exile==0)continue;
					cout<<i<<"号玩家发言:";
					cin>>speak;
				}
			}
			if(chief!=number)
			{
				for(int i=number;i>=1;i--)
				{
					if(chief+1+i-number<1){if(redandblack[chief+i+1].exile==0)continue;cout<<chief+i+1<<"号玩家发言:";}
					else {if(redandblack[chief+1+i-number].exile==0)continue;cout<<chief+1+i-number<<"号玩家发言:";} 
					cin>>speak;
				}
			}
		}
	cout<<"现在开始进行匿名投票选出被放逐者"<<endl;
	selectnamemax2(number);
	if(redandblack[chief].add==1){redandblack[chief].holdvote=redandblack[chief].holdvote-1;redandblack[chief].add=0;}
	cout<<"投票完成后村长所持票数："<<redandblack[chief].holdvote<<endl; 
			if(nummax!=redandblack[chief].vote)                   //被驱逐的人不是村长时 
			{
				cout<<"被放逐的人是"<<namemax<<"号"<<endl;
				if(redandblack[namemax].identifier==1){cout<<"他的身份是红牌"<<endl;nowred=nowred-1;} 
				if(redandblack[namemax].identifier==0){cout<<"他的身份是黑牌"<<endl;nowblack=nowblack-1;} 
				redandblack[namemax].exile=0;
				if(nowred==0){cout<<"所有红牌被放逐，游戏结束";system("pause");return 0;} 
				if(nowblack==0){cout<<"所有黑牌被放逐，游戏结束";system("pause");return 0;}
				cout<<"游戏继续"<<endl;

			}
			if(nummax==redandblack[chief].vote)                  //被驱逐的人是村长时 
			{
				cout<<"被放逐的人是"<<chief<<"号（村长）";				
				if(redandblack[namemax].identifier==1){cout<<"村长的身份是红牌"<<endl;nowred=nowred-1;} 
				if(redandblack[namemax].identifier==0){cout<<"村长的身份是黑牌"<<endl;nowblack=nowblack-1;}
				if(nowred==0){cout<<"所有红牌被放逐，游戏结束";system("pause");return 0;} 
				if(nowblack==0){cout<<"所有黑牌被放逐，游戏结束";system("pause");return 0;}
				cout<<"请重新发言选出村长"<<endl; 
				cout<<"游戏继续"<<endl;
				redandblack[chief].exile=0;
				selectnamemax1(number);
				chief=namemax;
				cout<<"村长是"<<chief<<"号"<<endl;
				if(number%2==1)redandblack[chief].holdvote=0.5;else redandblack[chief].holdvote=1.5;
				cout<<"此时村长所持票数："<<redandblack[chief].holdvote<<endl;
			}
	}
return 0;
}

